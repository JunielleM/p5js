<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid the Shapes Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
    </style>
</head>
<body>
<script>
let player;
let shapes = [];
let gameState = 'title'; // 'title', 'playing', 'win', 'lose'
let startTime;
let duration = 120000; // 2 minutes to waste the player's time
let shapeSpeed = 2;

let winSound;
let loseSound;

function preload() {
    winSound = loadSound('tadow.mp3');
    loseSound = loadSound('vomit.mp3'); //sound board for the win or lose
}

function setup() {
    createCanvas(600, 400);
    player = new Player(); //to create the player shape
}

function draw() {
    background(220);

    if (gameState === 'title') {
        drawTitleScreen();
    } else if (gameState === 'playing') {
        drawGame();
    } else if (gameState === 'win') {
        drawEndScreen('Congrats!');
    } else if (gameState === 'lose') {
        drawEndScreen('Bro how!');// If you win or lose these texts will appear
    }
}

function drawTitleScreen() {
    textSize(32);
    textAlign(CENTER, CENTER);
    fill(0);
    text('Minuto', width / 2, height / 2 - 20); //title screen
    textSize(16);
    text('Press ENTER to Start', width / 2, height / 2 + 20);
}

function drawGame() {
    let elapsedTime = millis() - startTime; // the time to survive the falling obstacles

    if (elapsedTime >= duration) {
        gameState = 'win';
        winSound.play();
    }

    if (elapsedTime > 60000) {
        shapeSpeed = 4;
    }

    player.update();
    player.display();

    for (let shape of shapes) {
        shape.update();
        shape.display();
        if (shape.collidesWith(player)) {
            gameState = 'lose';
            loseSound.play();
        }
    }

    shapes = shapes.filter(shape => !shape.isOffScreen());

    if (frameCount % 60 === 0) { // it will go faster and bigger once it reaches 60 seconds
        shapes.push(new Shape());
    }

    fill(0);
    textSize(16);
    textAlign(LEFT, TOP);
    text('Time: ' + nf(elapsedTime / 1000, 1, 2), 10, 10);
}

function drawEndScreen(message) {
    textSize(32);
    textAlign(CENTER, CENTER);
    fill(0);
    text(message, width / 2, height / 2 - 20);
    textSize(16);
    text('Press ENTER to Restart', width / 2, height / 2 + 20); //to restart press Enter
}

function keyPressed() {
    if (keyCode === ENTER) {
        if (gameState === 'title' || gameState === 'win' || gameState === 'lose') {
            startGame();
        }
    }
}

function startGame() {
    player = new Player();
    shapes = [];
    startTime = millis();
    shapeSpeed = 2;
    gameState = 'playing';
}

class Player {
    constructor() {
        this.size = 20;
        this.x = width / 2;
        this.y = height / 2;
        this.speed = 5;
    }

    update() {
        if (keyIsDown(LEFT_ARROW)) {
            this.x -= this.speed;
        }
        if (keyIsDown(RIGHT_ARROW)) {
            this.x += this.speed;
        }
        if (keyIsDown(UP_ARROW)) {
            this.y -= this.speed;
        }
        if (keyIsDown(DOWN_ARROW)) {
            this.y += this.speed;
        }

        this.x = constrain(this.x, 0, width);
        this.y = constrain(this.y, 0, height);
    }

    display() {
        fill(0);
        rect(this.x, this.y, this.size, this.size);
    }
}

class Shape {
    constructor() {
        this.size = random(20, 40);
        this.x = random(width);
        this.y = -this.size;
        this.speed = shapeSpeed;
    }

    update() {
        this.y += this.speed;
    }

    display() {
        fill(150);
        ellipse(this.x, this.y, this.size, this.size);
    }

    isOffScreen() {
        return this.y > height + this.size;
    }

    collidesWith(player) {
        let d = dist(this.x, this.y, player.x + player.size / 2, player.y + player.size / 2);
        return d < this.size / 2 + player.size / 2;
    }
}
</script>
</body>
</html>
